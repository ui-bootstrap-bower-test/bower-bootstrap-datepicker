angular.module("ui.bootstrap.datepicker",["ui.bootstrap.position"]).constant("datepickerConfig",{dayFormat:"dd",monthFormat:"MMMM",yearFormat:"yyyy",dayHeaderFormat:"EEE",dayTitleFormat:"MMMM yyyy",monthTitleFormat:"yyyy",showWeeks:!0,startingDay:0,yearRange:20,minDate:null,maxDate:null}).controller("DatepickerController",["$scope","$attrs","dateFilter","datepickerConfig",function(e,t,n,a){function o(t,n){return angular.isDefined(t)?e.$parent.$eval(t):n}function r(e,t){return new Date(e,t,0).getDate()}function i(e,t){for(var n=new Array(t),a=e,o=0;t>o;)n[o++]=new Date(a),a.setDate(a.getDate()+1);return n}function l(e,t,a,o){return{date:e,label:n(e,t),selected:!!a,secondary:!!o}}var s={day:o(t.dayFormat,a.dayFormat),month:o(t.monthFormat,a.monthFormat),year:o(t.yearFormat,a.yearFormat),dayHeader:o(t.dayHeaderFormat,a.dayHeaderFormat),dayTitle:o(t.dayTitleFormat,a.dayTitleFormat),monthTitle:o(t.monthTitleFormat,a.monthTitleFormat)},c=o(t.startingDay,a.startingDay),u=o(t.yearRange,a.yearRange);this.minDate=a.minDate?new Date(a.minDate):null,this.maxDate=a.maxDate?new Date(a.maxDate):null,this.modes=[{name:"day",getVisibleDates:function(e,t){var a=e.getFullYear(),o=e.getMonth(),u=new Date(a,o,1),d=c-u.getDay(),p=d>0?7-d:-d,g=new Date(u),m=0;p>0&&(g.setDate(-p+1),m+=p),m+=r(a,o+1),m+=(7-m%7)%7;for(var h=i(g,m),b=new Array(7),f=0;m>f;f++){var y=h[f];h[f]=l(y,s.day,t&&t.getDate()===y.getDate()&&t.getMonth()===y.getMonth()&&t.getFullYear()===y.getFullYear(),y.getMonth()!==o)}for(var D=0;7>D;D++)b[D]=n(h[D].date,s.dayHeader);return{objects:h,title:n(e,s.dayTitle),labels:b}},compare:function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate())-new Date(t.getFullYear(),t.getMonth(),t.getDate())},split:7,step:{months:1}},{name:"month",getVisibleDates:function(e,t){for(var a=new Array(12),o=e.getFullYear(),r=0;12>r;r++){var i=new Date(o,r,1);a[r]=l(i,s.month,t&&t.getMonth()===r&&t.getFullYear()===o)}return{objects:a,title:n(e,s.monthTitle)}},compare:function(e,t){return new Date(e.getFullYear(),e.getMonth())-new Date(t.getFullYear(),t.getMonth())},split:3,step:{years:1}},{name:"year",getVisibleDates:function(e,t){for(var n=new Array(u),a=e.getFullYear(),o=parseInt((a-1)/u,10)*u+1,r=0;u>r;r++){var i=new Date(o+r,0,1);n[r]=l(i,s.year,t&&t.getFullYear()===i.getFullYear())}return{objects:n,title:[n[0].label,n[u-1].label].join(" - ")}},compare:function(e,t){return e.getFullYear()-t.getFullYear()},split:5,step:{years:u}}],this.isDisabled=function(t,n){var a=this.modes[n||0];return this.minDate&&a.compare(t,this.minDate)<0||this.maxDate&&a.compare(t,this.maxDate)>0||e.dateDisabled&&e.dateDisabled({date:t,mode:a.name})}}]).directive("datepicker",["dateFilter","$parse","datepickerConfig","$log",function(e,t,n,a){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/datepicker.html",scope:{dateDisabled:"&"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(e,o,r,i){function l(){e.showWeekNumbers=0===m&&b}function s(e,t){for(var n=[];e.length>0;)n.push(e.splice(0,t));return n}function c(t){var n=null,o=!0;g.$modelValue&&(n=new Date(g.$modelValue),isNaN(n)?(o=!1,a.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):t&&(h=n)),g.$setValidity("date",o);var r=p.modes[m],i=r.getVisibleDates(h,n);angular.forEach(i.objects,function(e){e.disabled=p.isDisabled(e.date,m)}),g.$setValidity("date-disabled",!n||!p.isDisabled(n)),e.rows=s(i.objects,r.split),e.labels=i.labels||[],e.title=i.title}function u(e){m=e,l(),c()}function d(e){var t=new Date(e);t.setDate(t.getDate()+4-(t.getDay()||7));var n=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((n-t)/864e5)/7)+1}var p=i[0],g=i[1];if(g){var m=0,h=new Date,b=n.showWeeks;r.showWeeks?e.$parent.$watch(t(r.showWeeks),function(e){b=!!e,l()}):l(),r.min&&e.$parent.$watch(t(r.min),function(e){p.minDate=e?new Date(e):null,c()}),r.max&&e.$parent.$watch(t(r.max),function(e){p.maxDate=e?new Date(e):null,c()}),g.$render=function(){c(!0)},e.select=function(e){if(0===m){var t=g.$modelValue?new Date(g.$modelValue):new Date(0,0,0,0,0,0,0);t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),g.$setViewValue(t),c(!0)}else h=e,u(m-1)},e.move=function(e){var t=p.modes[m].step;h.setMonth(h.getMonth()+e*(t.months||0)),h.setFullYear(h.getFullYear()+e*(t.years||0)),c()},e.toggleMode=function(){u((m+1)%p.modes.length)},e.getWeekNumber=function(t){return 0===m&&e.showWeekNumbers&&7===t.length?d(t[0].date):null}}}}}]).constant("datepickerPopupConfig",{dateFormat:"yyyy-MM-dd",currentText:"Today",toggleWeeksText:"Weeks",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!0}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","datepickerPopupConfig","datepickerConfig",function(e,t,n,a,o,r,i){return{restrict:"EA",require:"ngModel",link:function(l,s,c,u){function d(e){w?w(l,!!e):b.isOpen=!!e}function p(e){if(e){if(angular.isDate(e))return u.$setValidity("date",!0),e;if(angular.isString(e)){var t=new Date(e);return isNaN(t)?void u.$setValidity("date",!1):(u.$setValidity("date",!0),t)}return void u.$setValidity("date",!1)}return u.$setValidity("date",!0),null}function g(e,n,a){e&&(l.$watch(t(e),function(e){b[n]=e}),x.attr(a||n,n))}function m(){b.position=y?a.offset(s):a.position(s),b.position.top=b.position.top+s.prop("offsetHeight")}var h,b=l.$new(),f=angular.isDefined(c.closeOnDateSelection)?l.$eval(c.closeOnDateSelection):r.closeOnDateSelection,y=angular.isDefined(c.datepickerAppendToBody)?l.$eval(c.datepickerAppendToBody):r.appendToBody;c.$observe("datepickerPopup",function(e){h=e||r.dateFormat,u.$render()}),b.showButtonBar=angular.isDefined(c.showButtonBar)?l.$eval(c.showButtonBar):r.showButtonBar,l.$on("$destroy",function(){W.remove(),b.$destroy()}),c.$observe("currentText",function(e){b.currentText=angular.isDefined(e)?e:r.currentText}),c.$observe("toggleWeeksText",function(e){b.toggleWeeksText=angular.isDefined(e)?e:r.toggleWeeksText}),c.$observe("clearText",function(e){b.clearText=angular.isDefined(e)?e:r.clearText}),c.$observe("closeText",function(e){b.closeText=angular.isDefined(e)?e:r.closeText});var D,w;c.isOpen&&(D=t(c.isOpen),w=D.assign,l.$watch(D,function(e){b.isOpen=!!e})),b.isOpen=D?D(l):!1;var k=function(e){b.isOpen&&e.target!==s[0]&&b.$apply(function(){d(!1)})},v=function(){b.$apply(function(){d(!0)})},$=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");$.attr({"ng-model":"date","ng-change":"dateSelection()"});var x=angular.element($.children()[0]),F={};c.datepickerOptions&&(F=l.$eval(c.datepickerOptions),x.attr(angular.extend({},F))),u.$parsers.unshift(p),b.dateSelection=function(e){angular.isDefined(e)&&(b.date=e),u.$setViewValue(b.date),u.$render(),f&&d(!1)},s.bind("input change keyup",function(){b.$apply(function(){b.date=u.$modelValue})}),u.$render=function(){var e=u.$viewValue?o(u.$viewValue,h):"";s.val(e),b.date=u.$modelValue},g(c.min,"min"),g(c.max,"max"),c.showWeeks?g(c.showWeeks,"showWeeks","show-weeks"):(b.showWeeks="show-weeks"in F?F["show-weeks"]:i.showWeeks,x.attr("show-weeks","showWeeks")),c.dateDisabled&&x.attr("date-disabled",c.dateDisabled);var T=!1,M=!1;b.$watch("isOpen",function(e){e?(m(),n.bind("click",k),M&&s.unbind("focus",v),s[0].focus(),T=!0):(T&&n.unbind("click",k),s.bind("focus",v),M=!0),w&&w(l,e)}),b.today=function(){b.dateSelection(new Date)},b.clear=function(){b.dateSelection(null)};var W=e($)(b);y?n.find("body").append(W):s.after(W)}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/datepicker/popup.html",link:function(e,t){t.bind("click",function(e){e.preventDefault(),e.stopPropagation()})}}}),angular.module("template/datepicker/datepicker.html",[]).run(["$templateCache",function(e){e.put("template/datepicker/datepicker.html",'<table><thead><tr><th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)"><i class="glyphicon glyphicon-chevron-left"></i></button></th><th colspan="{{rows[0].length - 2 + showWeekNumbers}}"><button type="button" class="btn btn-default btn-sm btn-block" ng-click="toggleMode()"><strong>{{title}}</strong></button></th><th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)"><i class="glyphicon glyphicon-chevron-right"></i></button></th></tr><tr ng-show="labels.length > 0" class="h6"><th ng-show="showWeekNumbers" class="text-center">#</th><th ng-repeat="label in labels" class="text-center">{{label}}</th></tr></thead><tbody><tr ng-repeat="row in rows"><td ng-show="showWeekNumbers" class="text-center"><em>{{ getWeekNumber(row) }}</em></td><td ng-repeat="dt in row" class="text-center"><button type="button" style="width:100%;" class="btn btn-default btn-sm" ng-class="{\'btn-info\': dt.selected}" ng-click="select(dt.date)" ng-disabled="dt.disabled"><span ng-class="{\'text-muted\': dt.secondary}">{{dt.label}}</span></button></td></tr></tbody></table>')}]),angular.module("template/datepicker/popup.html",[]).run(["$templateCache",function(e){e.put("template/datepicker/popup.html",'<ul class="dropdown-menu" ng-style="{display: (isOpen && \'block\') || \'none\', top: position.top+\'px\', left: position.left+\'px\'}"><li ng-transclude=""></li><li ng-show="showButtonBar" style="padding:10px 9px 2px"><span class="btn-group"><button type="button" class="btn btn-sm btn-info" ng-click="today()">{{currentText}}</button><button type="button" class="btn btn-sm btn-default" ng-click="showWeeks = ! showWeeks" ng-class="{active: showWeeks}">{{toggleWeeksText}}</button><button type="button" class="btn btn-sm btn-danger" ng-click="clear()">{{clearText}}</button></span><button type="button" class="btn btn-sm btn-success pull-right" ng-click="isOpen = false">{{closeText}}</button></li></ul>')}]);